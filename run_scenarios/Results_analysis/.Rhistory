x = "Date",
y = "bees.nesting.today"
)
plot_lambda.nat_nf
knitr::opts_chunk$set(echo = TRUE)
sim_cell_prod <- mean_sim_output %>%
filter(variable == "sum.cells")  %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
rm(list = ls())
library(ggplot2)
library(stringr)
library(dplyr)
library(tidyverse)
library(patchwork)
library(here)
mean_sim_output <- read.csv("Mean_scenarios/mean_ouputs_baseline.csv")
mean_sim_output$DateREP <- str_replace(mean_sim_output$DateREP, " 1", " 2015")
mean_sim_output$DateREP <- as.Date(mean_sim_output$DateREP, "%d %B %Y")
head(mean_sim_output)
#Nesting females  -- Nest occupied
NO_field <- read.csv("Validation_data/NestOccup.csv")
NO_field$date <- as.Date(NO_field$date)
head(NO_field)
field_NO_summarize<-NO_field %>%
group_by(date, treatment) %>%
summarise(female.sum = sum(female))
field_NO_summarize
# Cell production
cell_prod_field <- read.csv("Validation_data/CellProd.csv")
cell_prod_field $date <- as.Date(cell_prod_field $date)
head(cell_prod_field)
field_cell_prod_summarize <- cell_prod_field  %>%
group_by(date, treatment) %>%
summarise(brood.sum = sum(sum.cells))
#field_cell_prod_summarize$brood.sum.cum <- NA
for (i in 1:(nrow(field_cell_prod_summarize))){
if (i == 1){
field_cell_prod_summarize$brood.sum.cum[i] <- field_cell_prod_summarize$brood.sum[i]
} else {
field_cell_prod_summarize$brood.sum.cum[i] <- field_cell_prod_summarize$brood.sum.cum[i-1] + field_cell_prod_summarize$brood.sum[i]
}
}
head(field_cell_prod_summarize)
# Offspring emergence
offspring_field <- read.csv("Validation_data/OffspringOverview.csv")
offspring_field$female.mean.weight.g <- NULL
offspring_field$male.mean.weight.g <- NULL
head(offspring_field )
field_sex_ratio <- offspring_field$female.num / ( offspring_field$female.num + offspring_field$male.num)
unique(mean_sim_output$variable)
sim_all_var <- mean_sim_output %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
sim_all_var
#sim_all_var <- mean_sim_output %>%
#  filter(between(DateREP, as.Date("2015-04-24"), #as.Date("2015-05-27")))
sim_cell_prod <- mean_sim_output %>%
filter(variable == "sum.cells")  %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
sim_cell_prod
ggplot(sim_cell_prod,
aes(x = DateREP, y = mean)) +
geom_ribbon(aes(ymin = mean - 2*se, ymax = mean + 2*se),
alpha = 0.2) +
geom_line() +
geom_point(data = field_cell_prod_summarize,
aes(x = date, y = brood.sum.cum)) +
geom_line()+
labs(x = "Jour de l'année",
y = "Moyenne ± 2*SE",
title = "Moyenne des simulations (± 2*SE) – Année 1") +
theme_bw()
p_sum_cell <- ggplot(sim_cell_prod,
aes(x = DateREP, y = mean)) +
geom_ribbon(aes(ymin = mean - 2*se, ymax = mean + 2*se),
alpha = 0.2) +
geom_line() +
geom_point(data = field_cell_prod_summarize,
aes(x = date, y = brood.sum.cum)) +
geom_line()+
labs(x = "Date",
y = "sum.cells",
title = "") +
theme_bw()
p_sum_cell
p_nest_f <- ggplot(sim_nest_f,
aes(x = DateREP, y = mean)) +
geom_ribbon(aes(ymin = mean - 2*se, ymax = mean + 2*se),
alpha = 0.2) +
geom_line() +
geom_point(data = field_NO_summarize,
aes(x = date, y = female.sum)) +
labs(x = "Date",
y = "nest.f",
title = "Moyenne des simulations (± 2*SE) – Année 1") +
theme_bw()
sim_nest_f <- mean_sim_output %>%
filter(variable == "bees.nesting.today")  %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
sim_nest_f
field_NO_summarize
p_nest_f <- ggplot(sim_nest_f,
aes(x = DateREP, y = mean)) +
geom_ribbon(aes(ymin = mean - 2*se, ymax = mean + 2*se),
alpha = 0.2) +
geom_line() +
geom_point(data = field_NO_summarize,
aes(x = date, y = female.sum)) +
labs(x = "Date",
y = "nest.f",
title = "") +
theme_bw()
p_nest_f
field_sex_ratio <- offspring_field$female.num / ( offspring_field$female.num + offspring_field$male.num)
sim_offspring_male <- mean_sim_output %>%
filter(variable == "m.emerged.yr")  %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
sim_offspring_female <- mean_sim_output %>%
filter(variable == "f.emerged.yr")  %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
sim_sex_ratio <- sim_offspring_female$mean / (sim_offspring_female$mean + sim_offspring_male$mean)
sim_sex_ratio_df <- data.frame(date = sim_offspring_male$DateREP,
sex.ratio = sim_sex_ratio)
ggplot(sim_sex_ratio_df,
aes(x = date, y = sex.ratio)) +
geom_line() +
labs(x = "Jour de l'année",
y = "Moyenne ± 2*SE",
title = "Moyenne des simulations (± 2*SE) – Année 1") +
theme_bw()
field_sex_ratio
offspring_field
View(sim_nest_f)
View(sim_nest_f)
ggplot(sim_sex_ratio_df,
aes(x = date, y = sex.ratio)) +
geom_line() +
labs(x = "Jour de l'année",
y = "Moyenne ± 2*SE",
title = "Moyenne des simulations (± 2*SE) – Année 1") +
geom_point(aes(x=as.Date("2015-05-27") ,y=field_sex_ratio ))
ggplot(sim_sex_ratio_df,
aes(x = date, y = sex.ratio)) +
geom_line() +
labs(x = "Jour de l'année",
y = "Moyenne ± 2*SE",
title = "Moyenne des simulations (± 2*SE) – Année 1") +
geom_point(aes(x=as.Date("2015-05-27") ,y=field_sex_ratio )) +
theme_bw()
p_sum_cell <- ggplot(sim_cell_prod,
aes(x = DateREP, y = mean)) +
geom_ribbon(aes(ymin = mean - 2*se, ymax = mean + 2*se),
alpha = 0.2) +
geom_line() +
geom_point(data = field_cell_prod_summarize,
aes(x = date, y = brood.sum.cum)) +
geom_line()+
labs(x = "",
y = "sum.cells",
title = "") +
theme_bw()
p_sum_cell
p_nest_f <- ggplot(sim_nest_f,
aes(x = DateREP, y = mean)) +
geom_ribbon(aes(ymin = mean - 2*se, ymax = mean + 2*se),
alpha = 0.2) +
geom_line() +
geom_point(data = field_NO_summarize,
aes(x = date, y = female.sum)) +
labs(x = "Date",
y = "nest.f",
title = "") +
theme_bw()
p_nest_f
ggplot(sim_sex_ratio_df,
aes(x = date, y = sex.ratio)) +
geom_line() +
labs(x = "",
y = "",
title = "Proportion de femelles à l’émergence") +
geom_point(aes(x=as.Date("2015-05-27") ,y=field_sex_ratio )) +
theme_bw()
ggplot(sim_sex_ratio_df,
aes(x = date, y = sex.ratio)) +
geom_line() +
labs(x = "",
y = "Proportion de femelles à l’émergence",
title = "") +
geom_point(aes(x=as.Date("2015-05-27") ,y=field_sex_ratio )) +
theme_bw()
p_sex_ratio
p_sex_ratio <- ggplot(sim_sex_ratio_df,
aes(x = date, y = sex.ratio)) +
geom_line() +
labs(x = "",
y = "Proportion de femelles à l’émergence",
title = "") +
geom_point(aes(x=as.Date("2015-05-27") ,y=field_sex_ratio )) +
theme_bw()
p_sex_ratio
p_nest_f <- ggplot(sim_nest_f,
aes(x = DateREP, y = mean)) +
geom_ribbon(aes(ymin = mean - 2*se, ymax = mean + 2*se),
alpha = 0.2) +
geom_line() +
geom_point(data = field_NO_summarize,
aes(x = date, y = female.sum)) +
labs(x = "Date",
y = "nest.f",
title = "") +
theme_bw()
p_nest_f
combo_plots <- ( p_sum_cell | p_nest_f | p_sex_ratio)
combo_plots
ggsave(
paste(graph_file, "/validation_out_vars.png", sep=""),
plot   = combo_plots,
width  = 14,
height = 4
)
graph_file <- here("Graphs/Sens_analysis")
ggsave(
paste(graph_file, "/validation_out_vars.png", sep=""),
plot   = combo_plots,
width  = 14,
height = 4
)
all_scenarios <- read.csv("mean_outputs_all_scenarios.csv")
str(all_scenarios)
#Create a column which speficies the parameter
all_scenarios <- all_scenarios %>%
mutate(DateREP =  str_replace(DateREP, " 1", " 2015"),
DateREP = as.Date(DateREP, format= "%d %B %Y"),
param_type =
case_when(
str_detect(scenario_name, "QN") ~ "lambda.nat",
str_detect(scenario_name, "T")   ~ "temperature",
str_detect(scenario_name, "RH")  ~ "humidity",
TRUE ~ "other"
),
level = case_when(
str_detect(scenario_name, "baseline") ~ "baseline",
str_detect(scenario_name, "low") ~ "low",
str_detect(scenario_name, "high") ~ "high",
TRUE ~ "other"),
level = as.factor(level)) %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
#Filter the relevant parameter sand relevant timelines
sim_lambda.nat_sum.cells <- all_scenarios %>%
filter(param_type == "lambda.nat")  %>%
filter(variable == "sum.cells")
sim_temp_sum.cells <- all_scenarios %>% filter(param_type == "temperature") %>%
filter(variable == "sum.cells")
sim_rh_sum.cells <- all_scenarios %>% filter(param_type == "humidity") %>%
filter(variable == "sum.cells")
base_sim_cell_prod <- sim_cell_prod #Baseline scenario filtered out for relevant dates and relevant variable (sum.cells)
base_sim_cell_prod$level <- as.factor("baseline")
field_cell_prod <- field_cell_prod_summarize %>%
mutate(sum.cells =  brood.sum.cum)#field data
cols_levels <- c(
"baseline" = "black",
"low"      = "chartreuse4",
"high"     = "firebrick"
)
labs_levels <- c(
baseline = "Baseline",
low      = "Paramètre -10%",
high     = "Paramètre +10%"
)
p_RH <- ggplot() +
geom_line( # baseline simulation
data = base_sim_cell_prod,
aes(x = DateREP, y = mean, colour = level),
alpha = 0.15
) +
geom_line( # sensitivity simulation to a parameter
data = sim_rh_sum.cells,
aes(x = DateREP, y = mean, colour = level),
linewidth = 1.1
) +
geom_point( # Field observation
data = field_cell_prod,
aes(x = date, y = sum.cells),
size = 2.5,
colour = "black"
) +
scale_colour_manual(
values = cols_levels,
labels = labs_levels,
name   = "Scénario"
) +
theme_bw(base_size = 14) +
scale_x_date(date_labels = "%d-%m")+
labs(
title = "RH.max",
x = "",
y = "sum.cells"
)
p_RH
all_scenarios
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, sim_sum_cells = value)
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, sim_sum_cellse)
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, sim_sum_cells)
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, sum_cells)
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, sum.cells)
str(all_scenarios)
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, variable)
str(all_scenarios_sum_cells_params)
colnames(all_scenarios_sum_cells_params)
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, variable, mean)
field_cell_prod
field_cell_prod_summarize
field_cell_prod_summarize$DateRep <- field_cell_prod_summarize$date
field_cell_prod_summarize
rmse_df <- all_scenarios_sum_cells_params %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
group_by(param_type, level, scenario_name) %>%
summarise(
n = n(),
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
.groups = "drop"
) %>%
arrange(param_type, RMSE)
field_cell_prod_summarize$DateREP <- field_cell_prod_summarize$date
rmse_df <- all_scenarios_sum_cells_params %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
group_by(param_type, level, scenario_name) %>%
summarise(
n = n(),
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
.groups = "drop"
) %>%
arrange(param_type, RMSE)
rmse_df
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity", "baseline")) %>%
select(scenario_name, param_type, level, DateREP, variable, mean)
field_cell_prod_summarize$DateREP <- field_cell_prod_summarize$date
rmse_df <- all_scenarios_sum_cells_params %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
group_by(param_type, level, scenario_name) %>%
summarise(
n = n(),
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
.groups = "drop"
) %>%
arrange(param_type, RMSE)
rmse_df
unique(all_scenarios$param_type)
unique(all_scenarios$level)
unique(all_scenarios_sum_cells_params$level)
#Create a column which speficies the parameter
all_scenarios <- all_scenarios %>%
mutate(DateREP =  str_replace(DateREP, " 1", " 2015"),
DateREP = as.Date(DateREP, format= "%d %B %Y"),
param_type =
case_when(
str_detect(scenario_name, "QN") ~ "lambda.nat",
str_detect(scenario_name, "T")   ~ "temperature",
str_detect(scenario_name, "RH")  ~ "humidity",
TRUE ~ "other"
),
level = case_when(
str_detect(scenario_name, "baseline") ~ "baseline",
str_detect(scenario_name, "low") ~ "low",
str_detect(scenario_name, "high") ~ "high",
TRUE ~ "other"),
level = as.factor(level)) %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
str(all_scenarios$level)
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, variable, mean)
str(all_scenarios_sum_cells_params$level)
unique(all_scenarios_sum_cells_params$level)
field_cell_prod_summarize$DateREP <- field_cell_prod_summarize$date
rmse_df <- all_scenarios_sum_cells_params %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
group_by(param_type, level, scenario_name) %>%
summarise(
n = n(),
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
.groups = "drop"
) %>%
arrange(param_type, RMSE)
rmse_df
all_scenarios
all_scenarios <- read.csv("mean_outputs_all_scenarios.csv")
str(all_scenarios)
#Create a column which speficies the parameter
all_scenarios <- all_scenarios %>%
mutate(DateREP =  str_replace(DateREP, " 1", " 2015"),
DateREP = as.Date(DateREP, format= "%d %B %Y"),
param_type =
case_when(
str_detect(scenario_name, "QN") ~ "lambda.nat",
str_detect(scenario_name, "T")   ~ "temperature",
str_detect(scenario_name, "RH")  ~ "humidity",
TRUE ~ "other"
),
level = case_when(
str_detect(scenario_name, "baseline") ~ "baseline",
str_detect(scenario_name, "low") ~ "low",
str_detect(scenario_name, "high") ~ "high",
TRUE ~ "other"),
level = as.factor(level)) %>%
filter(between(DateREP, as.Date("2015-04-24"), as.Date("2015-05-27")))
str(all_scenarios)
all_scenarios_sum_cells_params <- all_scenarios %>%
filter(variable == "sum.cells") %>%
filter(param_type %in% c("lambda.nat", "temperature", "humidity")) %>%
select(scenario_name, param_type, level, DateREP, variable, mean)
unique(all_scenarios_sum_cells_params$level)
unique(all_scenarios$level)
base_sim_cell_prod
rsme_base_df <- all_scenarios %>%
filter(level == "baseline") %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
summarise(
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE))
) %>%
mutate(
level = "baseline",
param_type = c("lambda.nat", "temperature", "humidity")
)
rsme_base_df <- all_scenarios %>%
filter(level == "baseline") %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
summarise(
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE))
)
rsme_base_df
rmse_sens_df
rmse_sens_df <- all_scenarios_sum_cells_params %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
group_by(param_type, level, scenario_name) %>%
summarise(
n = n(),
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
.groups = "drop"
) %>%
arrange(param_type, RMSE)
rmse_sens_df
rsme_base_df
rsme_base_df
rmse_sens_df
nrow(field_cell_prod)
rsme_base_df
rsme_base_df <- all_scenarios %>%
filter(level == "baseline") %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
summarise(
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
n = n(),
)
rsme_base_df <- all_scenarios %>%
filter(level == "baseline") %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
summarise(
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
n = n()
)
rsme_base_df
rsme_base_df <- all_scenarios %>%
filter(level == "baseline") %>%
filter(param == "temperature") %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
summarise(
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
n = n()
)
rsme_base_df <- all_scenarios %>%
filter(level == "baseline") %>%
filter(param_type == "temperature") %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
summarise(
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
n = n()
)
rmse_sens_df
rsme_base_df
base_sim_cell_prod
rsme_base_df <- base_sim_cell_prod %>%
inner_join(field_cell_prod_summarize, by = "DateREP") %>%
summarise(
RMSE = sqrt(mean((mean - brood.sum.cum)^2, na.rm = TRUE)),
n = n()
)
rsme_base_df
rmse_sens_df
